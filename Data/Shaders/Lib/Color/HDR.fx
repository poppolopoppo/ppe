#ifndef _LIB_HDR_FX_INCLUDED
#define _LIB_HDR_FX_INCLUDED

namespace HDR {
//----------------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------
struct Params {
    float Exposure;
    float WhitePoint;
};
//----------------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------
float3 Uncharted2Tonemap(float3 x) {
    float A = 0.15;
    float B = 0.50;
    float C = 0.10;
    float D = 0.20;
    float E = 0.02;
    float F = 0.30;

    return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;
}
//----------------------------------------------------------------------------
static const float Uncharted2Tonemap_WhitePoint = 11.2;
//----------------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------
float3 ToneMap(float3 color, Params params) {

    color = color * params.Exposure;

    static const float exposureBias = 2.0f;
    float3 curr = Uncharted2Tonemap(exposureBias*color);

    float3 whiteScale = 1.0f/Uncharted2Tonemap(params.WhitePoint);
    float3 tone = curr*whiteScale;

    return tone;
}
//----------------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------
} //!namespace HDR

#endif //!_LIB_HDR_FX_INCLUDED
