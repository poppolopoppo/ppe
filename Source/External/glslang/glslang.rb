# frozen_string_literal: true

$Build.ppe_external!('glslang') do
    force_includes!(File.join(abs_path, 'Public', 'glslang-external.h'))
    extra_files!(
        'Public/glslang-external.h',
        *Build.glslang_headers )
    source_files!(*%w{
        Private/glslang.cpp
    })
    custom!() do |env, target|
        libraries << target.source_path(env, Build.glslang_libraries)
    end
    generate!('glslang-headers.generated.h', :public) do |facet, env, io|
        io.heredoc! %{
#pragma once
// glslang headers forwarding generated by #{Build::Script} v#{Build::VERSION}
}
        Build.glslang_headers.each do |header|
            abs = source_path(env, header)
            inc = Pathname.new(abs).relative_path_from(File.join(Build.glslang_path, 'include')).to_s
            rel = Pathname.new(abs).relative_path_from($SourcePath).to_s
            io.puts!('#pragma include_alias("%s", "%s")' % [inc, rel])
        end
    end
end
