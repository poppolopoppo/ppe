# frozen_string_literal: true

$Build.ppe_external!('glslang') do
    #public_deps!(namespace.spirv_tools)
    force_includes!(File.join(abs_path, 'Public', 'glslang-external.h'))
    extra_files!(
        'Public/glslang-external.h',
        *Build.glslang_headers(false) )
    source_files!(*%w{
        Private/glslang.cpp
        })
    custom!() do |env, target|
        libraries << target.source_path(env, Build.glslang_libraries(env.config.debug?))
    end
    generate!('glslang-headers.generated.h', :public) do |facet, env, io|
        io.heredoc! %{
#pragma once
// glslang headers forwarding generated by #{Build::Script} v#{Build::VERSION}
}
        debug = env.config.debug?
        include_path = Build.glslang_include_path(debug)
        Build.glslang_headers(debug).each do |header|
            abs = source_path(env, header)
            inc = Pathname.new(abs).relative_path_from(include_path).to_s
            rel = Pathname.new(abs).relative_path_from($SourcePath).to_s
            io.puts!('#pragma include_alias("%s", "%s")' % [inc, rel])
        end
    end
end
